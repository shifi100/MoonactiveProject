{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Desktop\\\\moon active\\\\Reactjs-Nodejs-MongoDB-CRUD-Example copy\\\\src\\\\PromotionList.js\";\nimport React, { Component } from 'react';\nimport { Button, ButtonGroup, Container, Table } from 'reactstrap';\nimport AppNavbar from './AppNavbar';\nimport { Link } from 'react-router-dom';\n\nclass PromotionList extends Component {\n  constructor(props) {\n    super(props);\n    this.pageNumber = 1;\n    this.lastScrollTop = 0;\n    this.totalPages = 0;\n    this.state = {\n      promotionsColumns: [],\n      promotionsLines: [],\n      isLoading: true\n    };\n    this.remove = this.remove.bind(this);\n    this.create = this.create.bind(this);\n    this.firstEvent = this.firstEvent.bind(this);\n  }\n\n  componentDidMount() {\n    this.setState({\n      isLoading: true\n    });\n    fetch('api/promotionsColumns').then(response => response.json()).then(data => this.setState({\n      promotionsColumns: data,\n      isLoading: false\n    }));\n    this.getPromotionLines();\n  }\n\n  async remove(id) {\n    await fetch(`/api/promotion/${id}`, {\n      method: 'DELETE',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(() => {\n      console.log(\"Remove Done!\");\n      let updatedPromotions = [...this.state.promotionsLines].filter(i => i._id !== id);\n      this.setState({\n        promotionsLines: updatedPromotions\n      });\n    });\n  }\n\n  async create(id) {\n    let promotion = [...this.state.promotionsLines].filter(i => i._id == id);\n    delete promotion[0]._id;\n    const newPromtion = {\n      promotionData: promotion[0]\n    };\n    await fetch(`/api/promotions`, {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(newPromtion)\n    }).then(async data => {\n      console.log(\"Create Done!\");\n      console.log(data.body);\n      this.pageNumber = 1;\n      await this.getPromotionLines();\n    });\n  }\n\n  firstEvent(e) {\n    var bottom = e.target.scrollHeight - e.target.scrollTop - e.target.clientHeight < 50;\n\n    if (bottom) {\n      this.pageNumber = this.pageNumber + 1;\n      if (this.pageNumber > this.totalPages) this.pageNumber = this.totalPages;\n      this.getPromotionLines();\n    }\n\n    var st = window.pageYOffset || e.target.scrollTop;\n\n    if (st == 0 && this.pageNumber > 1) {\n      this.pageNumber = this.pageNumber - 1;\n      this.getPromotionLines();\n    }\n\n    this.lastScrollTop = st <= 0 ? 0 : st;\n  }\n\n  async getPromotionLines() {\n    await fetch(`api/promotions?page=${this.pageNumber}`).then(response => response.json()).then(data => {\n      this.totalPages = data.totalPages;\n\n      if (this.pageNumber > 1) {\n        let arr = [...data.promotionInfo];\n        this.setState({\n          promotionsLines: arr\n        });\n      } else {\n        this.setState({\n          promotionsLines: data.promotionInfo\n        });\n      }\n    });\n  }\n\n  async generatePromotions() {\n    await fetch(`/api/generatePromotion`, {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      }\n    }).then(async data => {\n      this.pageNumber = 1;\n      await this.getPromotionLines();\n    });\n  }\n\n  render() {\n    const {\n      promotionsColumns,\n      promotionsLines,\n      isLoading\n    } = this.state;\n\n    if (isLoading) {\n      return /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 14\n        }\n      }, \"Loading...\");\n    }\n\n    const promotionList = promotionsColumns;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      fluid: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"float-right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      color: \"success\",\n      onClick: () => this.generatePromotions(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 13\n      }\n    }, \"Generate Promotions\")), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 11\n      }\n    }, \"Promotions\"), /*#__PURE__*/React.createElement(\"div\", {\n      onScroll: this.firstEvent,\n      className: \"promotionTable\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Table, {\n      className: \"mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"thead\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"th\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 19\n      }\n    }), Object.keys(promotionList).map(function (value) {\n      return /*#__PURE__*/React.createElement(\"th\", {\n        width: \"20%\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 28\n        }\n      }, value);\n    }), /*#__PURE__*/React.createElement(\"th\", {\n      width: \"10%\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 19\n      }\n    }, \"Actions\"))), /*#__PURE__*/React.createElement(\"tbody\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 15\n      }\n    }, promotionsLines.map(item => /*#__PURE__*/React.createElement(\"tr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"td\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"checkbox\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 23\n      }\n    })), Object.keys(item).map(function (value) {\n      if (value != '_id') {\n        return /*#__PURE__*/React.createElement(\"td\", {\n          width: \"20%\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 32\n          }\n        }, item[value]);\n      }\n    }), /*#__PURE__*/React.createElement(ButtonGroup, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      size: \"sm\",\n      color: \"danger\",\n      onClick: () => this.create(item[\"_id\"]),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 23\n      }\n    }, \"Duplicate\"), /*#__PURE__*/React.createElement(Button, {\n      size: \"sm\",\n      color: \"primary\",\n      tag: Link,\n      to: \"/promotion/\" + item[\"_id\"],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 23\n      }\n    }, \"Edit\"), /*#__PURE__*/React.createElement(Button, {\n      size: \"sm\",\n      color: \"danger\",\n      onClick: () => this.remove(item[\"_id\"]),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 23\n      }\n    }, \"Delete\")))))))));\n\n    /*#__PURE__*/\n    React.createElement(AppNavbar, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 7\n      }\n    });\n  }\n\n}\n\nexport default PromotionList;","map":{"version":3,"sources":["C:/Users/User/Desktop/moon active/Reactjs-Nodejs-MongoDB-CRUD-Example copy/src/PromotionList.js"],"names":["React","Component","Button","ButtonGroup","Container","Table","AppNavbar","Link","PromotionList","constructor","props","pageNumber","lastScrollTop","totalPages","state","promotionsColumns","promotionsLines","isLoading","remove","bind","create","firstEvent","componentDidMount","setState","fetch","then","response","json","data","getPromotionLines","id","method","headers","console","log","updatedPromotions","filter","i","_id","promotion","newPromtion","promotionData","body","JSON","stringify","e","bottom","target","scrollHeight","scrollTop","clientHeight","st","window","pageYOffset","arr","promotionInfo","generatePromotions","render","promotionList","Object","keys","map","value","item"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Button, ButtonGroup, Container, Table } from 'reactstrap';\r\nimport AppNavbar from './AppNavbar';\r\nimport { Link } from 'react-router-dom';\r\n\r\nclass PromotionList extends Component {\r\n\r\n  pageNumber = 1;\r\n  lastScrollTop = 0;\r\n  totalPages = 0;\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { promotionsColumns: [], promotionsLines: [], isLoading: true };\r\n    this.remove = this.remove.bind(this);\r\n    this.create = this.create.bind(this);\r\n    this.firstEvent = this.firstEvent.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setState({ isLoading: true });\r\n\r\n    fetch('api/promotionsColumns')\r\n      .then(response => response.json())\r\n      .then(data => this.setState({ promotionsColumns: data, isLoading: false }));\r\n\r\n    this.getPromotionLines();\r\n  }\r\n  async remove(id) {\r\n    await fetch(`/api/promotion/${id}`, {\r\n      method: 'DELETE',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'\r\n      }\r\n    }).then(() => {\r\n      console.log(\"Remove Done!\");\r\n      let updatedPromotions = [...this.state.promotionsLines].filter(i => i._id !== id);\r\n      this.setState({ promotionsLines: updatedPromotions });\r\n    });\r\n  }\r\n\r\n  async create(id) {\r\n    let promotion = [...this.state.promotionsLines].filter(i => i._id == id);\r\n    delete promotion[0]._id\r\n    const newPromtion = {\r\n      promotionData: promotion[0]\r\n    }\r\n    await fetch(`/api/promotions`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(newPromtion),\r\n    }).then(async (data) => {\r\n      console.log(\"Create Done!\");\r\n      console.log(data.body)\r\n      this.pageNumber = 1;\r\n      await this.getPromotionLines();\r\n    });\r\n  }\r\n\r\n  firstEvent(e) {\r\n    var bottom = e.target.scrollHeight - e.target.scrollTop - e.target.clientHeight < 50;\r\n    if (bottom) {\r\n      this.pageNumber = this.pageNumber + 1;\r\n      if (this.pageNumber > this.totalPages)\r\n        this.pageNumber = this.totalPages;\r\n      this.getPromotionLines();\r\n    }\r\n    var st = window.pageYOffset || e.target.scrollTop;\r\n    if (st == 0&&this.pageNumber>1) {\r\n      this.pageNumber = this.pageNumber - 1;\r\n      this.getPromotionLines();\r\n    }\r\n    this.lastScrollTop = st <= 0 ? 0 : st;\r\n  }\r\n\r\n\r\n\r\n  async getPromotionLines() {\r\n    await fetch(`api/promotions?page=${this.pageNumber}`)\r\n      .then(response => response.json())\r\n      .then(data => {\r\n        this.totalPages = data.totalPages;\r\n        if (this.pageNumber > 1) {\r\n          let arr = [...data.promotionInfo];\r\n          this.setState({ promotionsLines: arr });\r\n        } else {\r\n          this.setState({ promotionsLines: data.promotionInfo })\r\n        }\r\n      });\r\n  }\r\n\r\n  async generatePromotions() {\r\n    await fetch(`/api/generatePromotion`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json'\r\n      },\r\n    }).then(async (data) => {\r\n      this.pageNumber = 1;\r\n      await this.getPromotionLines();\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { promotionsColumns, promotionsLines, isLoading } = this.state;\r\n\r\n    if (isLoading) {\r\n      return <p>Loading...</p>;\r\n    }\r\n    const promotionList = promotionsColumns;\r\n\r\n    return (\r\n      <div >\r\n       \r\n        <Container fluid>\r\n          <div className=\"float-right\">\r\n            <Button color=\"success\" onClick={() => this.generatePromotions()}>Generate Promotions</Button>\r\n          </div>\r\n          <h3>Promotions</h3>\r\n          <div onScroll={this.firstEvent} className=\"promotionTable\">\r\n            <Table className=\"mt-4\">\r\n              <thead>\r\n                <tr>\r\n                  <th></th>\r\n                  {Object.keys(promotionList).map(function (value) {\r\n                    return <th width=\"20%\">\r\n                      {value}\r\n                    </th>\r\n                  })}\r\n                  <th width=\"10%\">Actions</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {promotionsLines.map((item) =>\r\n                  <tr>\r\n                    <td >\r\n                      <input type=\"checkbox\" ></input>\r\n                    </td>\r\n                    {Object.keys(item).map(function (value) {\r\n                      if (value != '_id') {\r\n                        return <td width=\"20%\" >\r\n                          {item[value]}\r\n                        </td>\r\n                      }\r\n                    })}\r\n                    <ButtonGroup >\r\n                      <Button size=\"sm\" color=\"danger\" onClick={() => this.create(item[\"_id\"])}>Duplicate</Button>\r\n                      <Button size=\"sm\" color=\"primary\" tag={Link} to={\"/promotion/\" + item[\"_id\"]}>Edit</Button>\r\n                      <Button size=\"sm\" color=\"danger\" onClick={() => this.remove(item[\"_id\"])}>Delete</Button>\r\n                    </ButtonGroup>\r\n                  </tr>\r\n                )}\r\n              </tbody>\r\n            </Table>\r\n           \r\n          </div>  \r\n        </Container>\r\n      \r\n      </div> \r\n    );<AppNavbar />\r\n  }\r\n}\r\n\r\nexport default PromotionList;"]},"metadata":{},"sourceType":"module"}